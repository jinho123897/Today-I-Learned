# JSON과 메서드

복잡한 객체를 다루고 있다고 가정해 봅시다. 네트워크를 통해 객체를 어딘가에 보내거나 로깅 목적으로 객체를 출력해야 한다면 객체를 문자열로 전환해야 할겁니다.   
   
이때 전환된 문자열엔 원하는 정보가 있는 객체 프로퍼티 모두가 포함되어야만 합니다.   
   
아래와 같은 메서드를 구현해 객체를 문자열로 전환해봅시다.   
```
let user = {
  name: "John",
  age: 30,
  
  toString() {
    return `{name: "${this.name}", age: ${this.age}}`;
  }
};

alert(user);  // {name: "John", age: 30}
```
그런데 개발 과정에서 프로퍼티가 추가되거나 삭제, 수정될 수 있습니다. 이렇게 되면 위에서 구현할 `toString`을 매번 수정해야 하는데 이는 아주 고통스러운 작업이 될 겁니다. 프로퍼티에 반복문을 돌리는 방법을 대안으로 사용할 수 있는데, 중첩 객체등으로 인해 객체가 복잡한 경우 이를 문자열로 변경하는 건 까다로운 작업이라 이마저도 쉽지 않을 겁니다.   
   
다행히 자바스크립틍엔 이런 문제를 해결해 방법해주는 방법이 있습니다. 관련 기능이 이미 구현되어 있어서 우리가 직접 코드를 짤 필요가 없습니다.


## JSON.stringify

JSON(JavaScript Object Notation)은 값이나 객체를 나타내주는 범용 포맷으로, RFC 4627 표준에 정의되어 있습니다. JSON은 본래 자바스크립트에서 사용할 목적으로 만들어진 포맷입니다. 그런데 라이브러리를 사용하면 자바스크립트가 아니 언어에서도 JSON을 충분히 다룰 수 있어서, JSON을 데이터 교환 목적으로 사용하는 경우가 많습니다. 특히 클라이언트 측 언어가 자바스크립트일 때 말이죠. 서버 측 언어는 무엇이든 상관없습니다.   
   
자바스크립트가 제공하는 JSON 관련 메서드는 아래와 같습니다.   
- `JSON.stiringify` - 객체를 JSON으로 바꿔줍니다.
- `JSON.parse` - JSON을 객체로 바꿔줍니다.

객체 `student`애 `JSON.stringify`를 적용해봅시다.
```
let student = {
  name: "John",
  age: 30,
  isAdmin: false,
  courses: ['html', 'css', 'js'],
  wife: null
};

let json = JSON.stringify(student);

alert(typeof json);  // string

alert(json);
/* JSON으로 인코딩된 객체:
{
  "name": "John",
  "age": 30,
  "isAdmin": false,
  "courses": ["html", "css", "js"],
  "wife": null
}
*/
```

`JSON.strigify(student)`를 호출하자 `student`가 문자열로 바뀌었습니다.   
   
이렇게 변경된 문자열은 JSON으로 인코딩된, 직렬화 처리된, 문자열로 변환된, 결집된 객체라고 부릅니다. 객체는 이렇게 문자열로 변환된 후에야 비로소 네트워크를 통해 전송하거나 저장소에 저장할 수 있습니다.   
   
JSON으로 인코딩된 객체는 일반 객체와 다른 특징을 보입니다.   

- 문자열은 큰 따옴표로 감싸야 합니다. JSON에선 작은 따옴표나 백틱을 사용할 수 없습니다.(`'John'`이 `"John"`으로 변경된 것을 통해 이를 확인할 수 있습니다.)
- 객체 프로퍼티 이름은 큰따옴표로 감싸야합니다.(`age: 30`이 `"age": 30`으로 변한 것을 통해 이를 확인할 수 있습니다.)
   
`JSON.stringify`는 객체뿐만 아니라 원시값에도 적용할 수 있습니다.   
   
적용할 수 있는 자료형은 아래와 같습니다.
- 객체 `{...}`
- 배열 `[...]`
- 원시형: 문자형, 숫자형, 불린형, `null`

```
// 숫자를 JSON으로 인코딩하면 숫자입니다.
alert( JSON.stringify(1) ) // 1

// 문자열을 JSON으로 인코딩하면 문자열입니다(다만, 큰따옴표가 추가됩니다.)
alert( JSON.stringify('test') );  // "test"

alert( JSON.stringify(true) );  // true

alert( JSON.strigify([1, 2, 3]);  // [1, 2, 3]
```


JSON은 데이터 교환을 목적으로 만들어진 언어에 종속되지 않는 포맷입니다. 따라서 자바스크립트 특유의 객체 프로퍼티는 `JSON.stringify`가 처리할 수 없습니다.   
   
`JSON.strigify`호출 시 무시되는 프로퍼티는 아래와 같습니다.
- 함수 프로퍼티 (메서드)
- 심볼형 프로퍼티 (키가 심볼인 프로퍼티)
- 값이 `undefined`인 프로퍼티

```
let user = {
  sayHi() { // 무시
    alert("Hello");
  },
  [Symbol("id")]: 123, // 무시
  something: undefined // 무시
};

alert( JSON.stringify(user) ); // {} 빈 객체가 출력됨
```
대대 이 프로퍼티들은 무시 되어도 괜찮습니다. 그런데 이들도 문자열에 포함시켜야 하는 경우가 생기고 하는데 이에 대해서 아래에서 다루도록 하겠습니다.   
   
`JSON.stringfy`의 장정 중 하나는 중첩 객체도 알아서 문자열로 바꿔준다는 점입니다.
```
let meetup = {
  title: "Conference",
  room: {
    number: 23,
    participants: ["john", "ann"]
  }
};

alert( JSON.stringify(meetup) );
/* 객체 전체가 문자열로 변환되었습니다.
{
  "title": "Conference",
  "room": {"number": 23, "participants": ["John", "ann"]},
}
*/
```
`JSON.stringify`를 사용할 때 주의하셔야 할 점이 하나 있습니다. 순환 참조가 있으면 원하는 대로 객체를 문자열로 바꾸는게 불가능합니다.   
```
let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: ["john", "ann"]
};

meetup.place = room;  // meetup은 room을 참조합니다.
room.occupiedBy = meetup; // room은 meetup을 참조합니다.

JSON.stringify(meetup); // Error: Converting circular structure to JSON
```
`room.occupiedBy`는 `meetup`을, `meetup.place`는 `room`을 참조하기 때문에 JSON으로의 변환이 실패했습니다.



## replacer로 원하는 프로퍼티만 직렬화하기

`JSON.stringify`의 전체 문법은 아래와 같습니다.
```
let json = JSON.stringify(value[, replace, space])
```
   
value   
인코딩 하려는 값   
   
replacer   
JSON으로 인코딩 하길 원하는 프로퍼티가 담긴 배열, 또는 매핑 함수 `function(key, value)`   
   
space   
서식 변경 목적으로 사용할 공백 문자 수   
   
대다수의 경우 `JSON.stringify`엔 인수를 하나만 넘겨서 사용합니다. 그런데 순환 참조를 다뤄야하는 경우같이 전환 프로세스를 정교하게 조정하려면 두 번째 인수를 사용해야 합니다.   
   
JSON으로 변환하길 원하는 프로퍼티가 담긴 배열을 두 번째 인수로 넘겨주면 이 프로퍼티들만 인코딩할 수 있습니다.   
```
let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup은 room을 참조합니다.
};

room.occupiedBy = meetup;  // room references meetup

alert( JSON.stringfy(meetup, ['title', 'participants']) );
// {"title": "Conference", "participants" : [{}, {}]}
```
